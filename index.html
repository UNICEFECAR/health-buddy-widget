<link href="assets/css/chat.css" rel="stylesheet" />
<script src="assets/js/bot.js"></script>
<div id="webchat" />
<script>
    function isMobile() {
        try {
            document.createEvent("TouchEvent");
            return true;
        } catch (e) {
            return false;
        }
    }    

    // language passed in url via string query
    var userLang = new URLSearchParams(window.location.search).get('lang');
    if (!userLang)
        // detecting user's browser language
        userLang = navigator.language.slice(0, 2);

    var initPayload = 'chat ' + userLang;     
    var lang = { en: "en", pt: "pt", ru: "ru", es: "es", it: "it", kk: "kk", el: "el", uz: "uz", pl: "pl" }   
    var buttonText = '';
    var inputText = '';

    var btnText = { 
        en: "Ask your Covid-19 question",
        pt: "Faça sua pergunta Covid-19",
        ru: "Задайте свой вопрос о Covid-19",
        es: "Haz tu pregunta sobre Covid-19",
        it: "Fai la tua domanda sul Covid-19",
        kk: "Ковид-19 сұрағыңызды қойыңыз",
        el: "Κάντε την ερώτησή σας για τον Covid-19",
        uz: "Covid-19 bo'yicha savolingizni bering",
        pl: "Zadaj pytanie dotyczące Covid-19"
    };   

    var txtText = { 
        en: "Type your question here",
        pt: "Digite sua pergunta aqui",
        ru: "Напечатайте свой вопрос здесь",
        es: "Escribe tu pregunta aqui",
        it: "Scrivi la tua domanda qui",
        kk: "Сұрағыңызды осы жерге теріңіз",
        el: "Πληκτρολογήστε την ερώτησή σας εδώ",
        uz: "Savolingizni shu yerga yozing",
        pl: "Wpisz tu swoje pytanie"
    };  

    switch(userLang) {
        case lang.pt:
            buttonText = btnText.pt;
            inputText = txtText.pt;
            break;
        case lang.ru:
            buttonText = btnText.ru;
            inputText = txtText.ru;
            break;
        case lang.es:
            buttonText = btnText.es;
            inputText = txtText.es;
            break;
        case lang.it:
            buttonText = btnText.it;
            inputText = txtText.it;
            break;
        case lang.kk:
            buttonText = btnText.kk;
            inputText = txtText.kk;
            break;
        case lang.el:
            buttonText = btnText.el;
            inputText = txtText.el;
            break;
        case lang.uz:
            buttonText = btnText.uz;
            inputText = txtText.uz;
            break;
        case lang.pl:
            buttonText = btnText.pl;
            inputText = txtText.pl;
            break;
        default:
            buttonText = btnText.en;
            inputText = txtText.en;
    }
    
    var setButtonText = function () {
        const paragraph = document.createElement("p");
        document.getElementsByClassName("push-launcher")[0].appendChild(paragraph);
        document.getElementsByClassName("push-launcher")[0].getElementsByTagName("p")[0].innerText = buttonText;
    }
   
    var config = {
        selector: "#webchat",
        initPayload: initPayload,
        channelUuid: "b46efd0e-849d-45c9-b056-370a71be6d60",
        host: "https://rapidpro.ilhasoft.mobi",
        title: "HealthBuddy",
        inputTextFieldHint: inputText,
        profileAvatar: "./assets/img/chat-avatar.svg",
        disableTooltips: true,
        docViewer: true,
        showFullScreenButton: true,
        hideWhenNotConnected: true,
        params: {
            images: {
                dims: {
                    width: 712,
                    height: 844
                }
            },
            storage: "session"
        },
        onSocketEvent: {
            'connect': () => setTimeout(setButtonText, 1000)
        }
    }
    if (!isMobile()) {
        WebChat.default.init(config);
    } else {
        // Mobile view
        config.tooltipPayload = initPayload;
        config.disableTooltips = false;
        WebChat.default.init(config);
    }
</script>
